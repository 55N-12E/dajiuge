"use strict";var vConsole,_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},info={};"test"==EnvCheck()&&(vConsole=new VConsole);var date=new Date,year=date.getFullYear(),month=date.getMonth()+1,pageNo=1,keyNum=1,timeout=null,url="",isGold=!0,slingshotType=1,browser=checkVersion(),env=EnvCheck(),api=locateJudge(),locateObj=getQueryString(),oldGiftLength=0;function getData(){$.get(api+"/hitball/userkey",{uid:info.uid},function(e){200==e.code&&$(".stoneNum span").text(e.data)})}function getPrizes(){$.get(api+"/hitball/prizes",function(e){if(200==e.code){for(var t="",i=0;i<e.data.hitballNormalPool.length;i++){1==(d=(n=(100*e.data.hitballNormalPool[i].showRate.replace(/%/g,"")).toString()).split(".")).length?e.data.hitballNormalPool[i].showRate=n:e.data.hitballNormalPool[i].showRate=d[0]+"."+d[1][0];var o=e.data.hitballNormalPool[i].showRate+"‱";t+="<tr><td><img src='"+e.data.hitballNormalPool[i].prizeImgUrl+"'></td><td>"+e.data.hitballNormalPool[i].prizeName+"</td><td>"+o+"</td>"}$(".gift-list.woodTable table tbody tr").remove(),$(".gift-list.woodTable table tbody").append(t);for(var a="",i=0;i<e.data.hitballGoldPool.length;i++){1==(d=(n=(100*e.data.hitballGoldPool[i].showRate.replace(/%/g,"")).toString()).split(".")).length?e.data.hitballGoldPool[i].showRate=n:e.data.hitballGoldPool[i].showRate=d[0]+"."+d[1][0];o=e.data.hitballGoldPool[i].showRate+"‱";a+="<tr><td><img src='"+e.data.hitballGoldPool[i].prizeImgUrl+"'></td><td>"+e.data.hitballGoldPool[i].prizeName+"</td><td>"+o+"</td>"}$(".gift-list.goldTable table tbody tr").remove(),$(".gift-list.goldTable table tbody").append(a);for(var n,d,s="",i=0;i<e.data.hitballTreasurePool.length;i++){1==(d=(n=(100*e.data.hitballTreasurePool[i].showRate.replace(/%/g,"")).toString()).split(".")).length?e.data.hitballTreasurePool[i].showRate=n:e.data.hitballTreasurePool[i].showRate=d[0]+"."+d[1][0];o=e.data.hitballTreasurePool[i].showRate+"‱";s+="<tr><td><img src='"+e.data.hitballTreasurePool[i].prizeImgUrl+"'></td><td>"+e.data.hitballTreasurePool[i].prizeName+"</td><td>"+o+"</td>"}$(".gift-list.rareTable table tbody tr").remove(),$(".gift-list.rareTable table tbody").append(s)}})}function truncated(e,t){var i="",o=!0,a=!1,n=void 0;try{for(var d,s=e[Symbol.iterator]();!(o=(d=s.next()).done);o=!0){if(i+=d.value,--t<=0)break}}catch(e){a=!0,n=e}finally{try{!o&&s.return&&s.return()}finally{if(a)throw n}}return i+".."}function renderRank(e){for(var t="",i=0;i<e.list.length;i++)t+='<div class="d-flex">\n              <div class="user-detail d-flex">\n                <span style="width: 19px;">'.concat(i+1,'</span>\n                <div class="user-avatar d-flex">\n                  <i class="toushi ').concat(4==e.list[i].nobleId?"huangjin-hd":5==e.list[i].nobleId?"bojin-hd":6==e.list[i].nobleId?"zuanshi-hd":7==e.list[i].nobleId?"xingyao-hd":"",'"></i>\n                  <img src="').concat(e.list[i].avatar,'" alt="">\n                </div>\n                <div>\n                  <p class="user-name">\n                    <span>').concat(5<e.list[i].nick.length?truncated(e.list[i].nick,5):e.list[i].nick,'</span>\n                    <img class="gender" src="./images/').concat(1==e.list[i].gender?"boy.png":"girl.png",'" alt="">\n                  </p>\n                  <p class="badge">\n                    <img src="').concat(e.list[i].experUrl,'" alt="">\n                    <img style="display:').concat(0==e.list[i].nobleId?"none":"inline",';" src="./images/').concat(1==e.list[i].nobleId?"putong.png":2==e.list[i].nobleId?"gaoji.png":3==e.list[i].nobleId?"baiyin.png":4==e.list[i].nobleId?"huangjin.png":5==e.list[i].nobleId?"bojin.png":6==e.list[i].nobleId?"zuanshi.png":7==e.list[i].nobleId?"xingyao.png":"putong.png",'" alt="">\n                  </p>\n                </div>\n              </div>\n              <div class="user-count d-flex">\n                <span>').concat(8<e.list[i].totalCount.toString().length?e.list[i].totalCount.toString()[0]+"."+e.list[i].totalCount.toString()[1]+e.list[i].totalCount.toString()[2]+"亿":e.list[i].totalCount,'</span>\n                <img style="width: 15px;height: 15px;margin-left: 5px;" src="./images/y-bean.png" alt="">\n              </div>\n            </div>');$(".rank-list").append(t)}function renderRecord(e,t){var i="";if(1==t){for(var o=0;o<e.length;o++)i+="<div class='d-flex'><p style='width: 30%;'>"+e[o].date+"</p><p class='text-center' style='width: 55%;'>"+e[o].prizeName+"<br />("+e[o].prizeValue+"约豆)</p><p class='text-center' style='width: 15%;'>"+e[o].prizeNum+"</p></div>";$(".record-list>div").append(i)}else if(2==t){for(o=0;o<e.length;o++)i+="<div class='d-flex'><p style='width: 30%;'>"+e[o].date+"</p><p class='text-center' style='width: 50%;'>"+e[o].typeDes+"</p><p class='text-center' style='width: 20%'>"+e[o].num+"</p></div>";$(".record-list>div").append(i)}}function getRecord(){var e=year+(10<=month?month:"0"+month).toString();1==$(".record-mid .switch-btn p.active")[0].dataset.type?$.post(api+"/hitball/hitball_record",{uid:info.uid,date:e,pageNo:pageNo,pageSize:10,ticket:info.ticket},function(e){200==e.code?(0<e.data.length&&(pageNo+=1),renderRecord(e.data,1)):alert(e.message)}):2==$(".record-mid .switch-btn p.active")[0].dataset.type&&$.post(api+"/hitball/hitball_stone_record",{uid:info.uid,date:e,pageNo:pageNo,pageSize:10,ticket:info.ticket},function(e){200==e.code?(0<e.data.length&&(pageNo+=1),renderRecord(e.data,2)):alert(e.message)})}function debounce(i,o){return function(){var e=this,t=arguments;null!==timeout&&clearTimeout(timeout),timeout=setTimeout(function(){i.apply(e,t)},o)}}function getMessage(e,t){info[e]=t}$(function(){browser.app?browser.ios?(window.webkit.messageHandlers.getUid.postMessage(null),window.webkit.messageHandlers.getTicket.postMessage(null),window.webkit.messageHandlers.getDeviceId.postMessage(null),window.webkit.messageHandlers.getRoomUid.postMessage(null)):browser.android&&androidJsObj&&"object"===("undefined"==typeof androidJsObj?"undefined":_typeof(androidJsObj))&&(info.uid=parseInt(window.androidJsObj.getUid()),info.ticket=window.androidJsObj.getTicket(),info.deviceId=window.androidJsObj.getDeviceId(),info.roomUid=parseInt(window.androidJsObj.getRoomUid())):(info.uid=924229,info.deviceId="MIPC880128"),$(".game-time .time-box1").click(function(){$(".game-time .time-box1").removeClass("active"),$(this).addClass("active"),keyNum=this.dataset.num}),$(".game-on .on-box1").click(function(){return 0==parseInt($(".stoneNum span").text())||parseInt($(".stoneNum span").text())<keyNum*(1==isGold?1:10)?($(".mask>.mask").show(),$(".notEnough").show(),$(".mask>.mask").click(function(e){e.target==$(".mask>.mask")[0]&&($(".mask>.mask").hide(),$(".notEnough").hide(),$(".mask>.mask").unbind())}),!1):void $.ajax({type:"post",url:api+"/hitball/drawHitball",headers:{pub_uid:info.uid},data:{uid:info.uid,roomUid:info.roomUid||"",keyNum:keyNum,deviceId:info.deviceId,ticket:info.ticket,type:isGold?"1":"2"},success:function(e){if(console.log(e),10006==e.code)console.log("石头不够");else if(200==e.code){$("#svga").hide(),$(".game-zone .slingshot").show(),$(".game-zone .game-set").show();var t="";if(50<$(".mid .ag").length)for(var i=0;i<30;i++)$(".mid .ag")[0].remove();if(oldGiftLength=e.data.prizeItemVoList.length,1==e.data.prizeItemVoList.length)t+="<div class='ag animate_gift0'><img src='"+e.data.prizeItemVoList[0].prizeImgUrl+"'><span>×"+e.data.prizeItemVoList[0].prizeNum+"</span></div>",$(".mid").append(t);else{for(var o=[],a=0;a<e.data.prizeItemVoList.length;a++)o.push(e.data.prizeItemVoList[a]);if(o.reverse(),8<o.length)for(i=0;i<8;i++)t+="<div class='ag animate_gift"+i+"'><img src='"+o[i].prizeImgUrl+"'><span>×"+o[i].prizeNum+"</span></div>";else for(i=0;i<o.length;i++)t+="<div class='ag animate_gift"+i+"'><img src='"+o[i].prizeImgUrl+"'><span>×"+o[i].prizeNum+"</span></div>";$(".mid").append(t)}$(".stoneNum span").text(e.data.remainKeyNum)}else 1413==e.code||($("#svga").hide(),$(".mask>.mask").hide(),$(".game-zone .slingshot").show(),$(".game-zone .game-set").show(),$(".toast").text("打气球失败，请稍后再试").fadeTo(400,1),setTimeout(function(){$(".toast").fadeTo(400,0)},1500))},error:function(e){var t;console.log(e),401==e.status&&(1413==(t=JSON.parse(e.responseText)).code?browser.app&&(browser.ios?window.webkit.messageHandlers.showPasswordDialog.postMessage(null):browser.android&&window.androidJsObj.showPasswordDialog()):1414==t.code&&($(".toast").text("请前往我的-设置-支付密码页面设置密码").fadeTo(400,1),setTimeout(function(){$(".toast").fadeTo(400,0)},1500)))}})}),$(".record-mid .record-list")[0].addEventListener("scroll",function(){Math.round($(this).scrollTop()+$(this).height())+50>=Math.round($(this).find("div")[0].scrollHeight)&&0!=Math.round($(this).find("div")[0].scrollHeight)&&(console.log("记录到底"),debounce(getRecord,300)())}),$(".rank-mid .rank-list")[0].addEventListener("scroll",function(){Math.round($(this).scrollTop()+$(this).height())==$(this).find("div")[0].scrollHeight&&console.log("排行到底")}),$(".record-mid .switch-btn p").click(function(){$(".record-mid .switch-btn p").removeClass("active"),$(this).addClass("active"),$(".record-mid .record-time span").text(date.getFullYear()+"年"+(date.getMonth()+1)+"月");var e=(date.getFullYear()+(10<=date.getMonth()+1?date.getMonth()+1:"0"+(date.getMonth()+1))).toString();$(".record-list>div .d-flex").remove(),pageNo=1,year=date.getFullYear(),month=date.getMonth()+1,clearTimeout(timeout),1==this.dataset.type?$.post(api+"/hitball/hitball_record",{uid:info.uid,date:e,pageNo:1,pageSize:10,ticket:info.ticket},function(e){200==e.code?(pageNo+=1,renderRecord(e.data,1)):alert(e.message)}):2==this.dataset.type&&$.post(api+"/hitball/hitball_stone_record",{uid:info.uid,date:e,pageNo:1,pageSize:10,ticket:info.ticket},function(e){200==e.code?(pageNo+=1,renderRecord(e.data,2)):alert(e.message)})}),$(".rank-mid .switch-btn p").click(function(){$(".rank-mid .switch-btn p").removeClass("active"),$(this).addClass("active");var e=this.dataset.type;$.get(api+"/hitball/type/rankinglist",{uid:info.uid,type:e},function(e){200==e.code?($(".rank-list>div").remove(),renderRank(e.data)):alert(e.message)})}),$(".record-mid .record-time span").text(year+"年"+month+"月"),$(".prev").click(function(){month-(pageNo=1)==0?(--year,month=12):--month,$(".record-list>div .d-flex").remove(),$(".record-mid .record-time span").text(year+"年"+month+"月")}),$(".next").click(function(){return month+(pageNo=1)>date.getMonth()+1&&year==date.getFullYear()?(console.log("查看未来"),!1):(12<month+1?(year+=1,month=1):month+=1,$(".record-list>div .d-flex").remove(),void $(".record-mid .record-time span").text(year+"年"+month+"月"))}),$(".mid").css("height","calc(100% - ".concat($(".bottom").height()+$(".top").height(),"px)")),$(".showRank").click(function(){$(".mid .ag").remove(),$(".game-zone").hide(),$(".rank").show(),$(".rank-mid .switch-btn p").removeClass("active"),$(".rank-mid .switch-btn p").eq(0).addClass("active"),$(".rank-mid").css("height",$("#rank")[0].clientHeight-$(".rank-top")[0].clientHeight-29),$(".rank-list").css("height",$(".rank-mid")[0].clientHeight-$(".rank-mid .switch-btn")[0].clientHeight-45),$.get(api+"/hitball/type/rankinglist",{uid:info.uid,type:1},function(e){200==e.code?($(".rank-list>div").remove(),renderRank(e.data)):alert(e.message)})}),$(".showRecord").click(function(){$(".mid .ag").remove(),$(".game-zone").hide(),$(".record").show(),$(".record-mid .switch-btn p").removeClass("active"),$(".record-mid .switch-btn p").eq(0).addClass("active"),$(".record-mid").css("height",$("#record")[0].clientHeight-$(".record-top")[0].clientHeight-29),$(".record-list").css("height",$(".record-mid")[0].clientHeight-$(".record-mid .switch-btn")[0].clientHeight-$(".record-time")[0].clientHeight-45);var e=date.getFullYear()+(10<=date.getMonth()+1?date.getMonth()+1:"0"+(date.getMonth()+1)).toString();$(".record-mid .record-time span").text(date.getFullYear()+"年"+(date.getMonth()+1)+"月"),pageNo=1,$.post(api+"/hitball/hitball_record",{uid:info.uid,date:e,pageNo:1,pageSize:10,ticket:info.ticket},function(e){200==e.code?(pageNo+=1,renderRecord(e.data,1)):alert(e.message)})}),$(".howtoPlay").click(function(){$(".mid .ag").remove(),$(".game-zone").hide(),$(".rule").show(),$(".rule-content").css("height",$("#rule")[0].clientHeight-$(".rule-top")[0].clientHeight-29)}),$(".exit").click(function(){$(".game-zone").show(),$(".record").hide(),$(".record-list>div .d-flex").remove(),$(".rank").hide(),$(".rule").hide()}),$(".getStone").click(function(){url="test"==EnvCheck()?"https://api.99date.hudongco.com/activity/hit-balloon/constellation/cancer/cancer.html":"https://prod.api.99date.hudongco.com/activity/hit-balloon/constellation/cancer/cancer.html",$(".mid .ag").remove(),browser.app?browser.android?window.androidJsObj.jumpNewWebPage(url):browser.ios&&setTimeout(function(){window.webkit.messageHandlers.closeAndJumpNewWebPage.postMessage(url)},300):(console.log(123),window.location.href=url)}),$(".switch-slingshot").click(function(e){debounce(function(){$(e.target).hasClass("active")||(isGold?(isGold=!1,$(".gold").addClass("active"),$(".wood").removeClass("active"),$(".tip").hide(),$(".balloon-g").show(),$(".balloon").hide().parent().hide(),$(".slingshot").attr("src","./images/slingshot-g.png"),$(".game-time .time-box1").eq(0).find("span").eq(1).text("10"),$(".game-time .time-box1").eq(1).find("span").eq(1).text("100"),$(".game-time .time-box1").eq(2).find("span").eq(1).text("1000")):(isGold=!0,$(".gold").removeClass("active"),$(".wood").addClass("active"),$(".tip").show(),$(".balloon-g").hide(),$(".balloon").show().parent().show(),$(".slingshot").attr("src","./images/slingshot.png"),$(".game-time .time-box1").eq(0).find("span").eq(1).text("1"),$(".game-time .time-box1").eq(1).find("span").eq(1).text("10"),$(".game-time .time-box1").eq(2).find("span").eq(1).text("100")))},300)()}),setTimeout(function(){getData(),getPrizes(),$(".record-time>img").on("click",debounce(getRecord,1e3)),$("#cover").click(function(e){e.target==$("#cover")[0]&&browser.app&&(browser.ios||browser.android&&androidJsObj&&"object"===("undefined"==typeof androidJsObj?"undefined":_typeof(androidJsObj))&&window.androidJsObj.closePage())})},100),document.addEventListener("visibilitychange",function(){getData()})});